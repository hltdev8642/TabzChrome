<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Terminal Launcher - TabzChrome</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent: #58a6ff;
            --accent-hover: #79b8ff;
            --green: #3fb950;
            --yellow: #d29922;
            --red: #f85149;
            --purple: #a371f7;
            --cyan: #39c5cf;
            --orange: #db6d28;
            --border: #30363d;
            --code-bg: #0d1117;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem;
        }

        code, pre, kbd, .terminal-body, .demo-output {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 2rem 0 3rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .hero-badges {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .badge {
            background: var(--bg-tertiary);
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .badge.claude { border-color: var(--orange); color: var(--orange); }
        .badge.codex { border-color: var(--green); color: var(--green); }
        .badge.gemini { border-color: var(--accent); color: var(--accent); }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
            gap: 0.5rem;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            font-size: 1rem;
            font-family: inherit;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab-btn.claude.active { color: var(--orange); border-bottom-color: var(--orange); }
        .tab-btn.codex.active { color: var(--green); border-bottom-color: var(--green); }
        .tab-btn.gemini.active { color: var(--accent); border-bottom-color: var(--accent); }

        .tab-icon {
            font-size: 1.25rem;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Demo Section */
        .demo-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .demo-section h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .demo-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .demo-controls label {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            flex: 1;
            min-width: 200px;
        }

        .demo-controls input,
        .demo-controls select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .demo-controls input:focus,
        .demo-controls select:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Checkbox styling */
        .checkbox-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .checkbox-label:hover {
            color: var(--text-primary);
        }

        /* Output preview */
        .preview-section {
            margin-top: 1.5rem;
        }

        .preview-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .demo-output {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        /* Command preview with syntax highlighting */
        .command-preview {
            color: var(--cyan);
        }

        .command-preview .flag { color: var(--purple); }
        .command-preview .value { color: var(--green); }

        /* Buttons */
        .button-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--green);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            filter: brightness(1.1);
        }

        .btn-secondary {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .btn-secondary:hover {
            background: var(--accent-hover);
        }

        .btn-tertiary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-tertiary:hover {
            background: var(--border);
        }

        /* Result message */
        .result-message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 6px;
            display: none;
        }

        .result-message.success {
            display: block;
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
        }

        .result-message.error {
            display: block;
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--red);
            color: var(--red);
        }

        .result-message.pending {
            display: block;
            background: rgba(210, 153, 34, 0.1);
            border: 1px solid var(--yellow);
            color: var(--yellow);
        }

        /* Quick presets */
        .presets {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .presets h4 {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .preset-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .preset-btn:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        /* Info notes */
        .info-note {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid var(--accent);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .info-note strong {
            color: var(--accent);
        }

        /* Terminal window style (for curl preview) */
        .terminal-window {
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin-top: 1rem;
        }

        .terminal-header {
            background: var(--bg-tertiary);
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: var(--red); }
        .dot.yellow { background: var(--yellow); }
        .dot.green { background: var(--green); }

        .terminal-title {
            margin-left: auto;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .terminal-body {
            padding: 1.25rem;
            font-size: 0.85rem;
            line-height: 1.6;
            overflow-x: auto;
        }

        /* Collapsible curl section */
        .collapsible {
            margin-top: 1rem;
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 0.85rem;
            padding: 0.5rem 0;
        }

        .collapsible-header:hover {
            color: var(--text-primary);
        }

        .collapsible-arrow {
            transition: transform 0.2s;
        }

        .collapsible.open .collapsible-arrow {
            transform: rotate(90deg);
        }

        .collapsible-content {
            display: none;
        }

        .collapsible.open .collapsible-content {
            display: block;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 600px) {
            body {
                padding: 1rem;
            }

            .hero h1 {
                font-size: 1.75rem;
            }

            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .demo-controls {
                flex-direction: column;
            }

            .demo-controls label {
                min-width: 100%;
            }

            .checkbox-row {
                flex-direction: column;
                gap: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="hero">
            <h1>AI Terminal Launcher</h1>
            <p class="tagline">Spawn AI coding assistant sessions in TabzChrome</p>
            <div class="hero-badges">
                <span class="badge claude">Claude Code</span>
                <span class="badge codex">OpenAI Codex</span>
                <span class="badge gemini">Google Gemini</span>
            </div>
        </header>

        <main>
            <!-- Tab Navigation -->
            <nav class="tab-nav">
                <button class="tab-btn claude active" data-tab="claude">
                    <span class="tab-icon">&#129302;</span>
                    Claude Code
                </button>
                <button class="tab-btn codex" data-tab="codex">
                    <span class="tab-icon">&#128161;</span>
                    Codex CLI
                </button>
                <button class="tab-btn gemini" data-tab="gemini">
                    <span class="tab-icon">&#9733;</span>
                    Gemini CLI
                </button>
            </nav>

            <!-- Claude Code Panel -->
            <div class="tab-panel active" id="claude-panel">
                <div class="demo-section">
                    <h3>Configure Claude Code Session</h3>

                    <div class="demo-controls">
                        <label>
                            Tab Name
                            <input type="text" id="claude-name" placeholder="Claude Worker" value="Claude">
                        </label>
                        <label>
                            Working Directory
                            <input type="text" id="claude-workingDir" placeholder="~/projects/myapp" value="~/projects">
                        </label>
                    </div>

                    <div class="demo-controls">
                        <label>
                            Agent
                            <select id="claude-agent">
                                <option value="">None (default)</option>
                                <option value="explore">Explore - Fast codebase exploration</option>
                                <option value="plan">Plan - Architecture planning</option>
                                <option value="code-reviewer">Code Reviewer</option>
                                <option value="general-purpose">General Purpose</option>
                                <option value="custom">Custom agent...</option>
                            </select>
                        </label>
                        <label id="claude-custom-agent-wrapper" style="display: none;">
                            Custom Agent Name
                            <input type="text" id="claude-custom-agent" placeholder="my-custom-agent">
                        </label>
                    </div>

                    <div class="demo-controls">
                        <label>
                            Model
                            <select id="claude-model">
                                <option value="">Sonnet (default)</option>
                                <option value="opus">Opus 4.5 - Most capable</option>
                                <option value="haiku">Haiku - Fast & efficient</option>
                            </select>
                        </label>
                        <label>
                            Permission Mode
                            <select id="claude-permission-mode">
                                <option value="bypass">YOLO (--dangerously-skip-permissions)</option>
                                <option value="">Default (ask for approval)</option>
                                <option value="acceptEdits">Accept Edits (auto-approve file changes)</option>
                                <option value="plan">Plan Mode (planning only)</option>
                            </select>
                        </label>
                    </div>

                    <div class="checkbox-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="claude-continue">
                            Continue previous session (-c)
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="claude-verbose">
                            Verbose output (--verbose)
                        </label>
                    </div>

                    <div class="preview-section">
                        <div class="preview-label">Generated Command:</div>
                        <div class="demo-output command-preview" id="claude-command-preview">claude</div>

                        <div class="preview-label">Tab Name:</div>
                        <div class="demo-output" id="claude-name-preview">Claude</div>
                    </div>

                    <div class="button-row">
                        <button class="btn-primary" onclick="spawnTerminal('claude')">
                            &#128640; Spawn Terminal
                        </button>
                        <button class="btn-secondary" onclick="copyCommand('claude')">
                            &#128203; Copy Command
                        </button>
                        <button class="btn-tertiary" onclick="copyCurl('claude')">
                            Copy curl
                        </button>
                    </div>

                    <div class="result-message" id="claude-result"></div>

                    <!-- Quick Presets -->
                    <div class="presets">
                        <h4>Quick Presets:</h4>
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="applyPreset('claude', 'yolo')">YOLO Mode</button>
                            <button class="preset-btn" onclick="applyPreset('claude', 'explore')">Explorer</button>
                            <button class="preset-btn" onclick="applyPreset('claude', 'planner')">Planner</button>
                            <button class="preset-btn" onclick="applyPreset('claude', 'reviewer')">Code Review</button>
                            <button class="preset-btn" onclick="applyPreset('claude', 'opus')">Opus Power</button>
                        </div>
                    </div>

                    <!-- Collapsible curl section -->
                    <div class="collapsible" id="claude-curl-section">
                        <div class="collapsible-header" onclick="toggleCollapsible('claude-curl-section')">
                            <span class="collapsible-arrow">&#9654;</span>
                            Show curl command
                        </div>
                        <div class="collapsible-content">
                            <div class="terminal-window">
                                <div class="terminal-header">
                                    <span class="dot red"></span>
                                    <span class="dot yellow"></span>
                                    <span class="dot green"></span>
                                    <span class="terminal-title">curl</span>
                                </div>
                                <div class="terminal-body">
                                    <pre id="claude-curl-preview"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Codex CLI Panel -->
            <div class="tab-panel" id="codex-panel">
                <div class="demo-section">
                    <h3>Configure Codex CLI Session</h3>

                    <div class="demo-controls">
                        <label>
                            Tab Name
                            <input type="text" id="codex-name" placeholder="Codex Worker" value="Codex">
                        </label>
                        <label>
                            Working Directory
                            <input type="text" id="codex-workingDir" placeholder="~/projects/myapp" value="~/projects">
                        </label>
                    </div>

                    <div class="demo-controls">
                        <label>
                            Model
                            <select id="codex-model">
                                <option value="">Default</option>
                                <option value="gpt-5.2-thinking">GPT-5.2 Thinking (best reasoning)</option>
                                <option value="gpt-5.2-instant">GPT-5.2 Instant (fast)</option>
                                <option value="gpt-5.2-pro">GPT-5.2 Pro (max accuracy)</option>
                                <option value="gpt-5.1">GPT-5.1</option>
                                <option value="o3">o3</option>
                                <option value="o4-mini">o4-mini</option>
                            </select>
                        </label>
                        <label>
                            Approval Policy (-a)
                            <select id="codex-approval">
                                <option value="">Default</option>
                                <option value="on-request">On Request (model decides)</option>
                                <option value="on-failure">On Failure (ask only if fails)</option>
                                <option value="untrusted">Untrusted (ask for non-trusted cmds)</option>
                                <option value="never">Never (auto-approve all)</option>
                            </select>
                        </label>
                    </div>

                    <div class="demo-controls">
                        <label>
                            Sandbox Mode (-s)
                            <select id="codex-sandbox">
                                <option value="">Default</option>
                                <option value="read-only">Read Only</option>
                                <option value="workspace-write">Workspace Write</option>
                                <option value="danger-full-access">Full Access (dangerous)</option>
                            </select>
                        </label>
                    </div>

                    <div class="checkbox-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="codex-full-auto" checked>
                            Full Auto (--full-auto) - Low-friction sandboxed execution
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="codex-search">
                            Enable Web Search (--search)
                        </label>
                    </div>

                    <div class="preview-section">
                        <div class="preview-label">Generated Command:</div>
                        <div class="demo-output command-preview" id="codex-command-preview">codex</div>

                        <div class="preview-label">Tab Name:</div>
                        <div class="demo-output" id="codex-name-preview">Codex</div>
                    </div>

                    <div class="button-row">
                        <button class="btn-primary" onclick="spawnTerminal('codex')">
                            &#128640; Spawn Terminal
                        </button>
                        <button class="btn-secondary" onclick="copyCommand('codex')">
                            &#128203; Copy Command
                        </button>
                        <button class="btn-tertiary" onclick="copyCurl('codex')">
                            Copy curl
                        </button>
                    </div>

                    <div class="result-message" id="codex-result"></div>

                    <div class="presets">
                        <h4>Quick Presets:</h4>
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="applyPreset('codex', 'full-auto')">Full Auto</button>
                            <button class="preset-btn" onclick="applyPreset('codex', 'gpt52')">GPT-5.2 Thinking</button>
                            <button class="preset-btn" onclick="applyPreset('codex', 'quiet')">No Prompts</button>
                        </div>
                    </div>

                    <div class="info-note">
                        <strong>Note:</strong> Codex CLI requires OpenAI API key. Set <code>OPENAI_API_KEY</code> environment variable before using.
                    </div>

                    <!-- Collapsible curl section -->
                    <div class="collapsible" id="codex-curl-section">
                        <div class="collapsible-header" onclick="toggleCollapsible('codex-curl-section')">
                            <span class="collapsible-arrow">&#9654;</span>
                            Show curl command
                        </div>
                        <div class="collapsible-content">
                            <div class="terminal-window">
                                <div class="terminal-header">
                                    <span class="dot red"></span>
                                    <span class="dot yellow"></span>
                                    <span class="dot green"></span>
                                    <span class="terminal-title">curl</span>
                                </div>
                                <div class="terminal-body">
                                    <pre id="codex-curl-preview"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gemini CLI Panel -->
            <div class="tab-panel" id="gemini-panel">
                <div class="demo-section">
                    <h3>Configure Gemini CLI Session</h3>

                    <div class="demo-controls">
                        <label>
                            Tab Name
                            <input type="text" id="gemini-name" placeholder="Gemini Worker" value="Gemini">
                        </label>
                        <label>
                            Working Directory
                            <input type="text" id="gemini-workingDir" placeholder="~/projects/myapp" value="~/projects">
                        </label>
                    </div>

                    <div class="demo-controls">
                        <label>
                            Model (-m)
                            <select id="gemini-model">
                                <option value="">Default (Gemini 3 Pro)</option>
                                <option value="gemini-3-pro">Gemini 3 Pro (most capable)</option>
                                <option value="gemini-3-flash">Gemini 3 Flash (fast)</option>
                                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                            </select>
                        </label>
                        <label>
                            Approval Mode
                            <select id="gemini-approval-mode">
                                <option value="yolo">YOLO (-y, auto-approve all)</option>
                                <option value="">Default (prompt for approval)</option>
                                <option value="auto_edit">Auto Edit (auto-approve edits)</option>
                            </select>
                        </label>
                    </div>

                    <div class="checkbox-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="gemini-sandbox">
                            Sandbox Mode (-s) - Run in isolated environment
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="gemini-debug">
                            Debug Mode (-d) - Show detailed output
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="gemini-resume">
                            Resume latest session (-r latest)
                        </label>
                    </div>

                    <div class="preview-section">
                        <div class="preview-label">Generated Command:</div>
                        <div class="demo-output command-preview" id="gemini-command-preview">gemini</div>

                        <div class="preview-label">Tab Name:</div>
                        <div class="demo-output" id="gemini-name-preview">Gemini</div>
                    </div>

                    <div class="button-row">
                        <button class="btn-primary" onclick="spawnTerminal('gemini')">
                            &#128640; Spawn Terminal
                        </button>
                        <button class="btn-secondary" onclick="copyCommand('gemini')">
                            &#128203; Copy Command
                        </button>
                        <button class="btn-tertiary" onclick="copyCurl('gemini')">
                            Copy curl
                        </button>
                    </div>

                    <div class="result-message" id="gemini-result"></div>

                    <div class="presets">
                        <h4>Quick Presets:</h4>
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="applyPreset('gemini', 'yolo')">YOLO Mode</button>
                            <button class="preset-btn" onclick="applyPreset('gemini', 'safe')">Safe Mode</button>
                            <button class="preset-btn" onclick="applyPreset('gemini', 'debug')">Debug</button>
                        </div>
                    </div>

                    <div class="info-note">
                        <strong>Note:</strong> Gemini CLI requires Google API credentials. Run <code>gcloud auth login</code> or set up Application Default Credentials.
                    </div>

                    <!-- Collapsible curl section -->
                    <div class="collapsible" id="gemini-curl-section">
                        <div class="collapsible-header" onclick="toggleCollapsible('gemini-curl-section')">
                            <span class="collapsible-arrow">&#9654;</span>
                            Show curl command
                        </div>
                        <div class="collapsible-content">
                            <div class="terminal-window">
                                <div class="terminal-header">
                                    <span class="dot red"></span>
                                    <span class="dot yellow"></span>
                                    <span class="dot green"></span>
                                    <span class="terminal-title">curl</span>
                                </div>
                                <div class="terminal-body">
                                    <pre id="gemini-curl-preview"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>
                Part of <a href="https://github.com/GGPrompts/TabzChrome">TabzChrome</a> |
                Backend must be running on <code>localhost:8129</code>
            </p>
        </footer>
    </div>

    <script>
        // ========================================
        // Tab Navigation
        // ========================================
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;

                // Update active tab button
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Update active panel
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                document.getElementById(`${tabId}-panel`).classList.add('active');
            });
        });

        // ========================================
        // Collapsible Sections
        // ========================================
        function toggleCollapsible(id) {
            document.getElementById(id).classList.toggle('open');
        }

        // ========================================
        // Claude Code Configuration
        // ========================================
        function buildClaudeCommand() {
            const parts = ['claude'];

            const agent = document.getElementById('claude-agent').value;
            const customAgent = document.getElementById('claude-custom-agent').value;
            const model = document.getElementById('claude-model').value;
            const permissionMode = document.getElementById('claude-permission-mode').value;
            const continueSession = document.getElementById('claude-continue').checked;
            const verbose = document.getElementById('claude-verbose').checked;

            if (agent === 'custom' && customAgent) {
                parts.push(`--agent ${customAgent}`);
            } else if (agent && agent !== 'custom') {
                parts.push(`--agent ${agent}`);
            }

            if (model) parts.push(`--model ${model}`);

            // Handle permission mode - 'bypass' is special case for --dangerously-skip-permissions
            if (permissionMode === 'bypass') {
                parts.push('--dangerously-skip-permissions');
            } else if (permissionMode) {
                parts.push(`--permission-mode ${permissionMode}`);
            }

            if (continueSession) parts.push('--continue');
            if (verbose) parts.push('--verbose');

            return parts.join(' ');
        }

        function buildClaudeName() {
            const baseName = document.getElementById('claude-name').value || 'Claude';
            const agent = document.getElementById('claude-agent').value;
            const customAgent = document.getElementById('claude-custom-agent').value;
            const model = document.getElementById('claude-model').value;

            const parts = [baseName];

            if (agent === 'custom' && customAgent) {
                parts.push(customAgent);
            } else if (agent && agent !== 'custom') {
                parts.push(agent.charAt(0).toUpperCase() + agent.slice(1).replace('-', ' '));
            }

            if (model) {
                parts.push(`(${model})`);
            }

            return parts.join(' ');
        }

        function updateClaudePreview() {
            const command = buildClaudeCommand();
            const name = buildClaudeName();
            const workingDir = document.getElementById('claude-workingDir').value || '~/projects';

            document.getElementById('claude-command-preview').textContent = command;
            document.getElementById('claude-name-preview').textContent = name;
            document.getElementById('claude-curl-preview').textContent = buildCurl(name, workingDir, command);

            // Show/hide custom agent input
            const agentSelect = document.getElementById('claude-agent').value;
            document.getElementById('claude-custom-agent-wrapper').style.display =
                agentSelect === 'custom' ? 'flex' : 'none';
        }

        // ========================================
        // Codex CLI Configuration
        // ========================================
        function buildCodexCommand() {
            const parts = ['codex'];

            const model = document.getElementById('codex-model').value;
            const approval = document.getElementById('codex-approval').value;
            const sandbox = document.getElementById('codex-sandbox').value;
            const fullAuto = document.getElementById('codex-full-auto').checked;
            const search = document.getElementById('codex-search').checked;

            if (model) parts.push(`--model ${model}`);
            if (fullAuto) parts.push('--full-auto');
            if (approval) parts.push(`-a ${approval}`);
            if (sandbox) parts.push(`-s ${sandbox}`);
            if (search) parts.push('--search');

            return parts.join(' ');
        }

        function buildCodexName() {
            const baseName = document.getElementById('codex-name').value || 'Codex';
            const model = document.getElementById('codex-model').value;

            if (model) {
                return `${baseName} (${model})`;
            }
            return baseName;
        }

        function updateCodexPreview() {
            const command = buildCodexCommand();
            const name = buildCodexName();
            const workingDir = document.getElementById('codex-workingDir').value || '~/projects';

            document.getElementById('codex-command-preview').textContent = command;
            document.getElementById('codex-name-preview').textContent = name;
            document.getElementById('codex-curl-preview').textContent = buildCurl(name, workingDir, command);
        }

        // ========================================
        // Gemini CLI Configuration
        // ========================================
        function buildGeminiCommand() {
            const parts = ['gemini'];

            const model = document.getElementById('gemini-model').value;
            const approvalMode = document.getElementById('gemini-approval-mode').value;
            const sandbox = document.getElementById('gemini-sandbox').checked;
            const debug = document.getElementById('gemini-debug').checked;
            const resume = document.getElementById('gemini-resume').checked;

            if (model) parts.push(`-m ${model}`);

            // Handle approval mode - 'yolo' uses -y flag, others use --approval-mode
            if (approvalMode === 'yolo') {
                parts.push('-y');
            } else if (approvalMode) {
                parts.push(`--approval-mode ${approvalMode}`);
            }

            if (sandbox) parts.push('-s');
            if (debug) parts.push('-d');
            if (resume) parts.push('-r latest');

            return parts.join(' ');
        }

        function buildGeminiName() {
            const baseName = document.getElementById('gemini-name').value || 'Gemini';
            const model = document.getElementById('gemini-model').value;

            if (model) {
                const shortModel = model.replace('gemini-', '').replace('-', ' ');
                return `${baseName} (${shortModel})`;
            }
            return baseName;
        }

        function updateGeminiPreview() {
            const command = buildGeminiCommand();
            const name = buildGeminiName();
            const workingDir = document.getElementById('gemini-workingDir').value || '~/projects';

            document.getElementById('gemini-command-preview').textContent = command;
            document.getElementById('gemini-name-preview').textContent = name;
            document.getElementById('gemini-curl-preview').textContent = buildCurl(name, workingDir, command);
        }

        // ========================================
        // Shared Utilities
        // ========================================
        function buildCurl(name, workingDir, command) {
            return `curl -X POST http://localhost:8129/api/spawn \\
  -H "Content-Type: application/json" \\
  -d '{
    "name": "${name}",
    "workingDir": "${workingDir}",
    "command": "${command}"
  }'`;
        }

        async function spawnTerminal(cli) {
            let name, workingDir, command;

            if (cli === 'claude') {
                name = buildClaudeName();
                workingDir = document.getElementById('claude-workingDir').value || '~/projects';
                command = buildClaudeCommand();
            } else if (cli === 'codex') {
                name = buildCodexName();
                workingDir = document.getElementById('codex-workingDir').value || '~/projects';
                command = buildCodexCommand();
            } else if (cli === 'gemini') {
                name = buildGeminiName();
                workingDir = document.getElementById('gemini-workingDir').value || '~/projects';
                command = buildGeminiCommand();
            }

            const resultDiv = document.getElementById(`${cli}-result`);
            resultDiv.className = 'result-message pending';
            resultDiv.innerHTML = '&#9203; Spawning terminal...';

            try {
                const response = await fetch('http://localhost:8129/api/spawn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, workingDir, command })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'result-message success';
                    resultDiv.innerHTML = `&#10003; Terminal spawned!<br><small>ID: ${data.terminal?.id || 'N/A'}</small>`;
                } else {
                    resultDiv.className = 'result-message error';
                    resultDiv.innerHTML = `&#10007; Failed: ${data.error || 'Unknown error'}`;
                }
            } catch (err) {
                resultDiv.className = 'result-message error';
                resultDiv.innerHTML = `&#10007; Error: ${err.message}<br><small>Is the backend running on localhost:8129?</small>`;
            }
        }

        function copyCommand(cli) {
            let command;
            if (cli === 'claude') command = buildClaudeCommand();
            else if (cli === 'codex') command = buildCodexCommand();
            else if (cli === 'gemini') command = buildGeminiCommand();

            navigator.clipboard.writeText(command).then(() => {
                showCopyFeedback(event.target);
            });
        }

        function copyCurl(cli) {
            let name, workingDir, command;

            if (cli === 'claude') {
                name = buildClaudeName();
                workingDir = document.getElementById('claude-workingDir').value || '~/projects';
                command = buildClaudeCommand();
            } else if (cli === 'codex') {
                name = buildCodexName();
                workingDir = document.getElementById('codex-workingDir').value || '~/projects';
                command = buildCodexCommand();
            } else if (cli === 'gemini') {
                name = buildGeminiName();
                workingDir = document.getElementById('gemini-workingDir').value || '~/projects';
                command = buildGeminiCommand();
            }

            const curl = buildCurl(name, workingDir, command);
            navigator.clipboard.writeText(curl).then(() => {
                showCopyFeedback(event.target);
            });
        }

        function showCopyFeedback(btn) {
            const originalText = btn.textContent;
            btn.textContent = 'âœ“ Copied!';
            setTimeout(() => btn.textContent = originalText, 1500);
        }

        // ========================================
        // Presets
        // ========================================
        function applyPreset(cli, preset) {
            if (cli === 'claude') {
                switch (preset) {
                    case 'yolo':
                        document.getElementById('claude-agent').value = '';
                        document.getElementById('claude-model').value = '';
                        document.getElementById('claude-permission-mode').value = 'bypass';
                        document.getElementById('claude-continue').checked = false;
                        document.getElementById('claude-verbose').checked = false;
                        break;
                    case 'explore':
                        document.getElementById('claude-agent').value = 'explore';
                        document.getElementById('claude-model').value = 'haiku';
                        document.getElementById('claude-permission-mode').value = 'bypass';
                        break;
                    case 'planner':
                        document.getElementById('claude-agent').value = 'plan';
                        document.getElementById('claude-model').value = '';
                        document.getElementById('claude-permission-mode').value = 'plan';
                        break;
                    case 'reviewer':
                        document.getElementById('claude-agent').value = 'code-reviewer';
                        document.getElementById('claude-model').value = '';
                        document.getElementById('claude-permission-mode').value = 'bypass';
                        break;
                    case 'opus':
                        document.getElementById('claude-agent').value = '';
                        document.getElementById('claude-model').value = 'opus';
                        document.getElementById('claude-permission-mode').value = 'bypass';
                        break;
                }
                updateClaudePreview();
            } else if (cli === 'codex') {
                switch (preset) {
                    case 'full-auto':
                        document.getElementById('codex-model').value = '';
                        document.getElementById('codex-approval').value = '';
                        document.getElementById('codex-sandbox').value = '';
                        document.getElementById('codex-full-auto').checked = true;
                        document.getElementById('codex-search').checked = false;
                        break;
                    case 'gpt52':
                        document.getElementById('codex-model').value = 'gpt-5.2-thinking';
                        document.getElementById('codex-full-auto').checked = true;
                        break;
                    case 'quiet':
                        // No quiet flag in Codex - using never-ask instead
                        document.getElementById('codex-approval').value = 'never';
                        document.getElementById('codex-full-auto').checked = true;
                        break;
                }
                updateCodexPreview();
            } else if (cli === 'gemini') {
                switch (preset) {
                    case 'yolo':
                        document.getElementById('gemini-approval-mode').value = 'yolo';
                        document.getElementById('gemini-sandbox').checked = false;
                        document.getElementById('gemini-debug').checked = false;
                        break;
                    case 'safe':
                        document.getElementById('gemini-approval-mode').value = '';
                        document.getElementById('gemini-sandbox').checked = true;
                        document.getElementById('gemini-debug').checked = false;
                        break;
                    case 'debug':
                        document.getElementById('gemini-debug').checked = true;
                        break;
                }
                updateGeminiPreview();
            }
        }

        // ========================================
        // Initialize
        // ========================================
        function init() {
            // Attach change listeners to Claude controls
            ['claude-name', 'claude-workingDir', 'claude-agent', 'claude-custom-agent',
             'claude-model', 'claude-permission-mode', 'claude-continue', 'claude-verbose'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('change', updateClaudePreview);
                    el.addEventListener('input', updateClaudePreview);
                }
            });

            // Attach change listeners to Codex controls
            ['codex-name', 'codex-workingDir', 'codex-model', 'codex-approval', 'codex-sandbox', 'codex-full-auto', 'codex-search'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('change', updateCodexPreview);
                    el.addEventListener('input', updateCodexPreview);
                }
            });

            // Attach change listeners to Gemini controls
            ['gemini-name', 'gemini-workingDir', 'gemini-model', 'gemini-approval-mode',
             'gemini-sandbox', 'gemini-debug', 'gemini-resume'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('change', updateGeminiPreview);
                    el.addEventListener('input', updateGeminiPreview);
                }
            });

            // Initial preview updates
            updateClaudePreview();
            updateCodexPreview();
            updateGeminiPreview();
        }

        // Run init on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
